- name: Nat VNFD
  shell: |
    cat >> /etc/cumulus/switchd.conf << EOF
    nat.dynamic_enable = TRUE
    nat.static_enable = TRUE
    EOF

- name: Restart service switchd
  systemd:
    state: restarted
    daemon_reload: yes
    name: switchd
    
- name: Nat VNFD
  shell: |
    net add nat {{ item.typeNat }} {{ item.routingType }} {{ item.protocol }} {{ item.sourceAddrPr | ipaddr('address') }} translate {{ item.destAddrPr | ipaddr('address') }}
    ifconfig eth0:{{ item.sourceAddrPr.split('.')[3] }} {{ item.sourceAddrPr }} netmask {{ item.sourceAddrPr | ipaddr('netmask') }}
  with_items: "{{ rules }}"
  when: rules is defined  and item.typeNat == "dnat"
  
- name: Nat VNFD
  shell: |
    net add nat {{ item.typeNat }} {{ item.routingType }} {{ item.protocol }} {{ item.sourceAddrPr | ipaddr('address') }} translate {{ item.destAddrPr | ipaddr('address') }}
    ifconfig eth0:{{ item.destAddrPr.split('.')[3] }} {{ item.destAddrPr }} netmask {{ item.destAddrPr | ipaddr('netmask') }}
  with_items: "{{ rules }}"
  when: rules is defined and item.typeNat == "snat"
  
- name: Nat VNFD
  shell: |
    net commit
    

