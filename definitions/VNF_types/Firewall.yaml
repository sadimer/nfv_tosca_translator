- name: Firewall VNFD
  shell: |
    iptables -A {{ item.routingPath }} -p {{ item.protocol }} -j {{ item.action }} -s {{ item.sourceAddr }} -d {{ item.destAddr }} --sport {{ item.sourcePort }} --dport {{ item.destPort }}
  with_items: "{{ Firewall_standart_rules }}"
  when: Firewall_standart_rules is defined and (item.protocol == "udp" or item.protocol == "tcp")

- name: Firewall VNFD
  shell: |
    iptables -A {{ item.routingPath }} -p {{ item.protocol }} -j {{ item.action }} -s {{ item.sourceAddr }} -d {{ item.destAddr }}
  with_items: "{{ Firewall_standart_rules }}"
  when: Firewall_standart_rules is defined and (item.protocol != "udp" and item.protocol != "tcp")

- name: DPI VNFD
  shell: |
    iptables -A {{ item.routingPath }} -m ndpi --{{ item.deepProtocol }} -j {{ item.action }} -s {{ item.sourceAddr }} -d {{ item.destAddr }}
  with_items: "{{ Firewall_dpi_rules }}"
  when: Firewall_dpi_rules is defined
